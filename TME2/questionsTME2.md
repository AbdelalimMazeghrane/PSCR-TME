# Questions - TME 2 : Conteneurs, Map, Lib Standard

Instructions : copiez vos réponses dans ce fichier (sous la question correspondante). A la fin de la séance, commitez vos réponses.

1) Exécutez le programme (mode `count`) sur le fichier fourni. Combien y a-t-il de mots dans le livre ?

Réponse (collez une trace ici) :
464700: you
464800: their
464900: his
465000: and
465100: to
465200: he
465300: the
465400: the
465500: to
465600: use
465700: mass
465800: because
465900: continues
466000: continue
466100: supplies
466200: suddenly
466300: of
466400: time
466500: of
466600: beside
466700: it
466800: and
466900: field
467000: clear
467100: in
467200: their
467300: need
467400: to
467500: happened
467600: that
467700: i
467800: his
467900: comfortable
468000: make
468100: swaying
468200: shed
468300: mind
468400: were
468500: of
468600: andrew
468700: enjoyment
468800: destroys
468900: freedom
469000: behind
469100: the
469200: his
469300: the
469400: karataev
469500: reached
469600: at
469700: their
469800: forward
469900: the
470000: sheds
470100: because
470200: city
470300: prisoners
470400: heathens
470500: prisoners
470600: rows
470700: they
470800: the
470900: from
471000: dare
471100: recognized
471200: all
471300: officer
471400: a
471500: that
471600: that
471700: he
471800: reaction
471900: companions
472000: of
472100: man
472200: me
472300: that
472400: which
472500: and
472600: sent
472700: many
472800: of
472900: detachment
473000: from
473100: send
473200: cottage
473300: in
473400: duty
473500: sulphur
473600: in
473700: at
473800: or
473900: and
474000: noise
474100: to
474200: since
474300: be
474400: proofs
474500: general
474600: waited
474700: fight
474800: preparing
474900: such
475000: them
475100: me
475200: he
475300: but
475400: historians
475500: it
475600: one
475700: suite
475800: have
475900: which
476000: and
476100: their
476200: unheardof
476300: to
476400: could
476500: to
476600: at
476700: they
476800: the
476900: strength
477000: own
477100: say
477200: which
477300: not
477400: moscow
477500: rapier
477600: french
477700: and
477800: pose
477900: it
478000: of
478100: his
478200: because
478300: assignment
478400: threeline
478500: these
478600: therefore
478700: obtainable
478800: according
478900: dog
479000: by
479100: up
479200: still
479300: large
479400: no
479500: 
479600: in
479700: than
479800: capture
479900: who
480000: angry
480100: horse
480200: overcoat
480300: bay
480400: had
480500: dlokhov
480600: there
480700: merry
480800: dispatch
480900: to
481000: the
481100: he
481200: the
481300: leaves
481400: house
481500: the
481600: the
481700: horses
481800: the
481900: vexation
482000: french
482100: of
482200: laying
482300: pike
482400: french
482500: pretended
482600: frenchman
482700: long
482800: disappear
482900: said
483000: i
483100: the
483200: i
483300: angry
483400: man
483500: ptya
483600: experienced
483700: had
483800: decided
483900: of
484000: officers
484100: want
484200: fine
484300: are
484400: fed
484500: a
484600: in
484700: while
484800: feet
484900: but
485000: did
485100: order
485200: will
485300: go
485400: or
485500: on
485600: but
485700: talking
485800: on
485900: his
486000: password
486100: for
486200: on
486300: of
486400: dlokhov
486500: push
486600: fire
486700: with
486800: said
486900: russian
487000: not
487100: a
487200: and
487300: recognized
487400: just
487500: will
487600: fright
487700: mile
487800: the
487900: the
488000: as
488100: unknown
488200: finished
488300: mingled
488400: march
488500: invisible
488600: the
488700: with
488800: and
488900: lighter
489000: noon
489100: a
489200: from
489300: galloped
489400: to
489500: and
489600: used
489700: and
489800: in
489900: each
490000: allotted
490100: cold
490200: stores
490300: kept
490400: within
490500: roses
490600: all
490700: the
490800: when
490900: twentysecond
491000: was
491100: steps
491200: his
491300: to
491400: the
491500: sent
491600: while
491700: for
491800: deed
491900: of
492000: the
492100: the
492200: at
492300: desire
492400: joyful
492500: over
492600: something
492700: a
492800: is
492900: surface
493000: extent
493100: frowning
493200: crowd
493300: house
493400: all
493500: dlokhov
493600: cossacks
493700: army
493800: french
493900: regiments
494000: proportion
494100: when
494200: they
494300: his
494400: enemys
494500: stay
494600: army
494700: gauntlet
494800: the
494900: this
495000: about
495100: to
495200: and
495300: just
495400: were
495500: and
495600: and
495700: is
495800: we
495900: russians
496000: napoleon
496100: of
496200: directed
496300: and
496400: had
496500: kutzov
496600: an
496700: not
496800: town
496900: where
497000: nation
497100: hospitals
497200: a
497300: menace
497400: in
497500: mysterious
497600: of
497700: called
497800: for
497900: and
498000: feet
498100: gaze
498200: now
498300: his
498400: would
498500: because
498600: know
498700: said
498800: when
498900: snyawere
499000: tears
499100: inside
499200: she
499300: mother
499400: became
499500: power
499600: but
499700: and
499800: life
499900: vital
500000: with
500100: natsha
500200: day
500300: in
500400: accustomed
500500: talked
500600: ran
500700: or
500800: up
500900: hundred
501000: the
501100: french
501200: kutzov
501300: must
501400: the
501500: past
501600: without
501700: staff
501800: he
501900: courtier
502000: reflections
502100: who
502200: with
502300: wrote
502400: be
502500: words
502600: of
502700: krasnoe
502800: with
502900: that
503000: so
503100: pedestal
503200: to
503300: themselves
503400: had
503500: fleeting
503600: general
503700: and
503800: said
503900: ordinary
504000: to
504100: right
504200: mans
504300: clear
504400: arms
504500: staff
504600: and
504700: heavy
504800: up
504900: made
505000: left
505100: order
505200: a
505300: men
505400: this
505500: crackle
505600: the
505700: but
505800: got
505900: the
506000: whose
506100: from
506200: was
506300: took
506400: old
506500: asleep
506600: several
506700: were
506800: porridge
506900: the
507000: turning
507100: the
507200: valiant
507300: brought
507400: would
507500: at
507600: seat
507700: cutting
507800: were
507900: the
508000: that
508100: berezina
508200: that
508300: with
508400: tsarevich
508500: the
508600: aged
508700: was
508800: he
508900: incidentally
509000: the
509100: uniform
509200: hand
509300: at
509400: mans
509500: was
509600: which
509700: which
509800: and
509900: thus
510000: recruit
510100: of
510200: not
510300: remembered
510400: borodino
510500: immediately
510600: deprive
510700: he
510800: for
510900: it
511000: feeling
511100: been
511200: had
511300: for
511400: his
511500: others
511600: she
511700: at
511800: own
511900: holding
512000: like
512100: the
512200: he
512300: letting
512400: the
512500: of
512600: money
512700: to
512800: and
512900: proof
513000: to
513100: town
513200: they
513300: pleasure
513400: or
513500: was
513600: the
513700: householders
513800: factories
513900: was
514000: they
514100: french
514200: of
514300: any
514400: aroused
514500: borodino
514600: but
514700: see
514800: her
514900: killed
515000: to
515100: on
515200: distress
515300: he
515400: were
515500: rescued
515600: of
515700: and
515800: yes
515900: she
516000: snya
516100: nor
516200: was
516300: that
516400: pierre
516500: them
516600: dreamed
516700: rich
516800: to
516900: such
517000: to
517100: into
517200: constantly
517300: out
517400: time
517500: now
517600: did
517700: the
517800: but
517900: but
518000: told
518100: said
518200: with
518300: it
518400: so
518500: did
518600: such
518700: seeing
518800: he
518900: all
519000: honest
519100: he
519200: being
519300: would
519400: go
519500: natsha
519600: she
519700: i
519800: mary
519900: you
520000: marys
520100: joy
520200: them
520300: oh
520400: conceited
520500: himself
520600: smiles
520700: smile
520800: knew
520900: and
521000: said
521100: the
521200: did
521300: a
521400: that
521500: it
521600: us
521700: armies
521800: progress
521900: he
522000: the
522100: of
522200: presentday
522300: with
522400: or
522500: inaccessible
522600: was
522700: endsthe
522800: aim
522900: words
523000: appear
523100: that
523200: superfluous
523300: and
523400: alexander
523500: east
523600: and
523700: opponents
523800: his
523900: to
524000: does
524100: has
524200: seizing
524300: power
524400: he
524500: the
524600: hasten
524700: no
524800: city
524900: always
525000: account
525100: reason
525200: but
525300: a
525400: manager
525500: was
525600: necessity
525700: when
525800: each
525900: bee
526000: say
526100: place
526200: further
526300: would
526400: who
526500: his
526600: refusing
526700: old
526800: army
526900: having
527000: food
527100: to
527200: with
527300: nothing
527400: relations
527500: expression
527600: snyas
527700: nicholas
527800: why
527900: to
528000: i
528100: for
528200: tone
528300: of
528400: started
528500: bring
528600: is
528700: and
528800: face
528900: was
529000: to
529100: corn
529200: seemed
529300: manage
529400: all
529500: called
529600: man
529700: one
529800: with
529900: return
530000: her
530100: all
530200: administration
530300: elder
530400: pale
530500: vexation
530600: event
530700: did
530800: his
530900: concern
531000: made
531100: daily
531200: she
531300: sorry
531400: sterile
531500: the
531600: hundred
531700: family
531800: his
531900: wife
532000: farmespecially
532100: and
532200: with
532300: frequently
532400: him
532500: chairs
532600: that
532700: his
532800: get
532900: sturdy
533000: notice
533100: like
533200: like
533300: had
533400: yes
533500: somebody
533600: daniel
533700: whispered
533800: woman
533900: convalescent
534000: in
534100: something
534200: not
534300: delicacy
534400: had
534500: know
534600: with
534700: questions
534800: a
534900: familythat
535000: to
535100: wifes
535200: money
535300: but
535400: essentials
535500: of
535600: when
535700: a
535800: letter
535900: nursery
536000: so
536100: yet
536200: out
536300: that
536400: he
536500: you
536600: ptya
536700: bright
536800: with
536900: is
537000: pierres
537100: else
537200: who
537300: dessalles
537400: with
537500: he
537600: forgetting
537700: he
537800: had
537900: unrolling
538000: a
538100: was
538200: she
538300: which
538400: of
538500: stillexisting
538600: understood
538700: full
538800: all
538900: the
539000: mad
539100: had
539200: the
539300: whiskers
539400: old
539500: began
539600: things
539700: and
539800: pierre
539900: come
540000: of
540100: here
540200: take
540300: interest
540400: from
540500: and
540600: all
540700: said
540800: was
540900: told
541000: when
541100: action
541200: and
541300: what
541400: broke
541500: homme
541600: trying
541700: a
541800: if
541900: to
542000: after
542100: nicholas
542200: a
542300: eyes
542400: but
542500: the
542600: with
542700: duty
542800: noticed
542900: risks
543000: no
543100: an
543200: continued
543300: to
543400: overseer
543500: else
543600: she
543700: and
543800: the
543900: talking
544000: not
544100: every
544200: i
544300: she
544400: else
544500: own
544600: wished
544700: imagine
544800: never
544900: bear
545000: a
545100: of
545200: me
545300: and
545400: a
545500: them
545600: god
545700: with
545800: what
545900: should
546000: of
546100: is
546200: secondly
546300: then
546400: slay
546500: divine
546600: and
546700: to
546800: great
546900: defeated
547000: anyone
547100: of
547200: general
547300: certain
547400: what
547500: of
547600: produced
547700: question
547800: the
547900: and
548000: of
548100: historian
548200: others
548300: consequently
548400: by
548500: the
548600: of
548700: event
548800: cause
548900: all
549000: event
549100: go
549200: having
549300: conception
549400: as
549500: with
549600: paper
549700: concerning
549800: may
549900: those
550000: a
550100: us
550200: who
550300: the
550400: it
550500: of
550600: the
550700: the
550800: transferred
550900: their
551000: young
551100: of
551200: xvi
551300: to
551400: of
551500: people
551600: serves
551700: a
551800: popes
551900: the
552000: kurbski
552100: the
552200: we
552300: men
552400: seems
552500: should
552600: by
552700: direction
552800: the
552900: by
553000: enters
553100: the
553200: opposite
553300: and
553400: not
553500: and
553600: formed
553700: an
553800: to
553900: as
554000: the
554100: the
554200: between
554300: whom
554400: and
554500: movement
554600: numerous
554700: corresponding
554800: that
554900: less
555000: a
555100: was
555200: from
555300: in
555400: is
555500: wherever
555600: connection
555700: to
555800: combine
555900: infinitythat
556000: the
556100: of
556200: years
556300: presented
556400: to
556500: as
556600: in
556700: deductions
556800: always
556900: live
557000: time
557100: what
557200: regardedas
557300: say
557400: never
557500: is
557600: to
557700: be
557800: presentation
557900: the
558000: partly
558100: certain
558200: or
558300: due
558400: to
558500: consideration
558600: those
558700: his
558800: life
558900: examine
559000: the
559100: and
559200: object
559300: more
559400: act
559500: the
559600: examined
559700: the
559800: and
559900: where
560000: short
560100: in
560200: examine
560300: is
560400: any
560500: raise
560600: same
560700: and
560800: the
560900: of
561000: content
561100: i
561200: form
561300: the
561400: inevitability
561500: man
561600: it
561700: the
561800: only
561900: free
562000: but
562100: we
562200: old
562300: that
562400: it
562500: discovery
562600: impossible
562700: struggle
562800: passion
562900: the
563000: of
563100: to
563200: the
563300: and
563400: and
563500: this
563600: the
563700: a
563800: gutenberg
563900: gutenbergtm
564000: are
564100: which
564200: be
564300: e
564400: e
564500: a
564600: derive
564700: donations
564800: work
564900: set
565000: of
565100: direct
565200: provide
565300: of
565400: of
565500: free
565600: about
565700: extent
565800: project
565900: and
566000: the
566100: are
Finished parsing.
Found a total of 566193 words.
Total runtime (wall clock) : 2586 ms


2) Comment le temps d'exécution est-il impacté par les variations suivantes ?

- exécuter en mode Debug vs Release
- garder l'affichage d'un mot toutes les 100 lectures vs supprimer cette trace
- placer le fichier WarAndPeace dans `/tmp/` (si vous êtes à la ppti, par défaut vous travaillez sur NFS, /tmp est un disque local).

Réponse :

Runtime debug avec trace :

Runtime debug sans trace :

Runtime release avec trace :

Runtime release sans trace :

(mesures nfs vs tmp si à la ppti)

3) Implémentez un nouveau mode "unique", en vous aidant du squelette fourni. 
Modifiez le programme pour compter le nombre de mots différents que contient le texte. Pour cela on propose dans un premier temps de stocker tous les mots rencontrés dans un vecteur, et de traverser ce vecteur à chaque nouveau mot rencontré pour vérifier s'il est nouveau ou pas.
Exécutez le programme sur le fichier WarAndPeace.txt fourni. Combien y a-t-il de mots différents ? Combien de temps prend l'execution ?

Réponse (collez une trace ici) :

Parsing ../WarAndPeace.txt (mode=unique)
Found 20333 unique words.
Total runtime (wall clock) : 10398 ms

4) Modifiez le programme pour introduire le mode "freq" qui calcule le nombre d'occurrences de chaque mot (fréquence). 
Pour cela, on adaptera le code précédent pour utiliser un vecteur qui stocke des `pair<string,int>` au lieu de stocker juste des string. 
Afficher le nombre d'occurrences des mots "war", "peace" et "toto".

Réponse :
Parsing ../WarAndPeace.txt (mode=freq)
war : 298
peace : 114
Total runtime (wall clock) : 10486 ms

5) Trier ce vecteur de paires par nombre d'occurrences décroissantes à l'aide de `std::sort` puis afficher les dix mots les plus fréquents. 

`std::sort` prend les itérateurs de début et fin de la zone à trier, et un prédicat binaire. Voir l'exemple suivant.

```CPP
#include <vector>
#include <string>
#include <algorithm>

class Etu {
	public :
	std::string nom;
	int note;
};

int main_sort () {
	std::vector<Etu> etus ;
	// plein de push_back de nouveaux étudiants dans le désordre

	// par ordre alphabétique de noms croissants
	std::sort(etus.begin(), etus.end(), [] (const Etu & a, const Etu & b) { return a.nom < b.nom ;});
	// par notes décroissantes
	std::sort(etus.begin(), etus.end(), [] (const Etu & a, const Etu & b) { return a.note > b.note ;});
	return 0;
}
```

Réponse :
les dix mots les plus fréquents :
the : 34562
and : 22148
to : 16709
of : 14990
a : 10513
he : 9809
in : 8800
his : 7965
that : 7806
was : 7327
Total runtime (wall clock) : 11904 ms


6) Quelle est la complexité de ce code en temps et mémoire ? Donnez une trace avec temps d'exécution en mode release.


Réponse :
Parsing ../WarAndPeace.txt (mode=freq)
war : 298
peace : 114
les dix mots les plus fréquents :
the : 34562
and : 22148
to : 16709
of : 14990
a : 10513
he : 9809
in : 8800
his : 7965
that : 7806
was : 7327
Total runtime (wall clock) : 1706 ms


7) Implantez une table de hash simple en partant du squelette fourni HashMap.h:
 * Définir un struct Entry, muni de champs key et value et d'un constructeur. La clé peut être const. 
 * La table de hash stocke un `vector` de `forward_list` de `Entry` et le nombre d'entrées qu'elle contient. Le vecteur "buckets" est alloué à la construction à la taille demandée, en plaçant une liste vide dans chaque bucket.
 * Implantez le constructeur de la classe et l'opération size (remplissage actuel)
 * Implantez les deux méthodes principales, à la sémantique proche de Java.

 ```
 // Return pointer to value associated with key, or nullptr if not found.
 V* get(const K& key);

 // Insert or update (key,value).
 // Returns true if an existing entry was updated, false if a new entry was inserted.
 bool put(const K& key, const V& value);
```    

Réponse : Dans le fichier HashMap.h

8) En appui sur une table de hash \texttt{HashMap<string,int>} associant des entiers (le nombre d'occurrence) aux mots, et reprendre les questions où l'on calculait de nombre d'occurrences des mots avec cette nouvelle structure de donnée. Ce sera le nouveau mode "freqhash". Pensez à déclarer le nouveau fichier dans `CMakeLists.txt`. Combien de temps prend le calcul ? Testez quelques valeurs pour la taille initiale de la table, e.g. 100, 1024, 10000 vu que la table ne grossit jamais actuellement. Gardez un setting qui fonctionne bien.

Réponse : tracer les temps

1024:
Parsing ../WarAndPeace.txt (mode=freqhash)
Total runtime (wall clock) : 2944 ms

100:
Parsing ../WarAndPeace.txt (mode=freqhash)
Total runtime (wall clock) : 6515 ms

10000:
Parsing ../WarAndPeace.txt (mode=freqhash)
Total runtime (wall clock) : 2595 ms

9) On souhaite comme dans la version précédente afficher les 10 mots les plus fréquents.
Ajoutez dans la table de hash une fonction `std::vector<std::pair<K,V>> toKeyValuePairs() const` qui convertit les entrées de la table en un vecteur de paires. Pour celà on parcourt chaque liste de chaque bucket. Contrôlez les résultats par rapport à la version "freq" simple.

Réponse : 
Parsing ../WarAndPeace.txt (mode=freqhash)
les dix mots les plus fréquents :
the : 34562
and : 22148
to : 16709
of : 14990
a : 10513
he : 9809
in : 8800
his : 7965
that : 7806
was : 7327
Total runtime (wall clock) : 2607 ms

10) Ecrire un nouveau mode "freqstd" qui s'appuie sur la classe du standard `std::unordered_map` pour faire la même chose que "freqhash". Pour la partie extraction des entrées vers un vecteur pour les trier, on peut simplement itérer la table (même s'il y a d'autres méthodes comme `std::copy`)

```
unordered_map<string,int> map;
for (const pair<string,int> & entry : map) {
    cout << "Key:" << entry.first << " Value " << entry.second << "\n";
}
```

Remesurer les performances avec cette version.

Réponse :
Parsing ../WarAndPeace.txt (mode=freqstd)
the : 34562
and : 22148
to : 16709
of : 14990
a : 10513
he : 9809
in : 8800
his : 7965
that : 7806
was : 7327
Total runtime (wall clock) : 2617 ms

11) Conclure sur la qualité de notre structure de données maison.
notre version a les memes performaces que celle de lib

12) BONUS: Si la taille actuelle est supérieure ou égale à 80\% du nombre de buckets, la table est considérée surchargée :
 la plupart des accès vont nécessiter d'itérer des listes. On souhaite dans ce cas doubler la taille d'allocation (nombre de buckets).  Ecrivez une fonction membre \texttt{void grow()} qui agrandit (double le nombre de buckets) d'une table contenant déjà des éléments.  Quelle est la complexité de cette réindexation ?

 Indices : créez une table vide mais allouée à la bonne taille, itérer nos entrées actuelles et les insérer une par une dans la cible, écraser notre table avec celle de l'autre (voire utiliser un `std::move`).

